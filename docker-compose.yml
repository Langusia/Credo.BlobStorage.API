services:
  api:
    build:
      context: .
      dockerfile: src/Credo.BlobStorage.Api/Dockerfile
    container_name: blobstorage-api
    ports:
      - "5000:8080"
    volumes:
      - /2017:/mnt/storage/2017
      # - /2018:/mnt/storage/2018
      # - /2019:/mnt/storage/2019
    restart: unless-stopped

  migrator:
    build:
      context: .
      dockerfile: tools/Credo.BlobStorage.Migrator/Dockerfile
    container_name: blobstorage-migrator
    depends_on:
      - api
    volumes:
      - ./logs:/app/logs
    # Run once and exit - use "docker compose run migrator" to execute
    # Or override config via environment variables
    profiles:
      - migration

  migrator:
    build:
      context: .
      dockerfile: tools/Credo.BlobStorage.Migrator/Dockerfile
    container_name: blobstorage-migrator
    volumes:
      - ./logs:/app/logs
    depends_on:
      - api
    # Runs once and exits - start manually with: docker compose run migrator
    profiles:
      - tools
